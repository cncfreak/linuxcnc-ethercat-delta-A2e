loadrt [KINS]KINEMATICS
loadrt [EMCMOT]EMCMOT base_period_nsec=[EMCMOT]BASE_PERIOD servo_period_nsec=[EMCMOT]SERVO_PERIOD num_joints=[KINS]JOINTS
loadusr -W lcec_conf ASDA_A2E.xml
loadrt lcec
loadrt cia402 

loadrt bitslice personality=32
loadrt bitmerge personality=5

setp cia402.0.csp-mode 1
setp cia402.0.pos-scale 100000

addf lcec.read-all            servo-thread
addf cia402.0.read-all        servo-thread
addf motion-command-handler   servo-thread
addf motion-controller        servo-thread
addf cia402.0.write-all       servo-thread
addf lcec.write-all           servo-thread

addf bitslice.0 servo-thread
addf bitmerge.0 servo-thread

#*******************
#  AXIS X
#*******************

# --- joint signals for motion

net x-pos-cmd    <= joint.0.motor-pos-cmd
net x-pos-fb     <= joint.0.motor-pos-fb
net x-enable     <= joint.0.amp-enable-out

# --- connect stepper driver to joint

net x-pos-cmd    => cia402.0.pos-cmd
net x-pos-fb     => cia402.0.pos-fb
net x-enable     => cia402.0.enable

# --- from stepper(ethercat) to cia402

net x-statusword      lcec.0.0.cia-statusword  => cia402.0.statusword
net x-opmode-display  lcec.0.0.opmode-display  => cia402.0.opmode-display
net x-drv-act-pos     lcec.0.0.actual-position => cia402.0.drv-actual-position
net x-drv-act-velo    lcec.0.0.actual-velocity => cia402.0.drv-actual-velocity

# --- from cia402 to stepper(ethercat) 

net x-controlword         cia402.0.controlword         => lcec.0.0.cia-controlword
net x-modes-of-operation  cia402.0.opmode              => lcec.0.0.opmode
net x-drv-target-pos      cia402.0.drv-target-position => lcec.0.0.target-position
net x-drv-target-velo     cia402.0.drv-target-velocity => lcec.0.0.target-velocity

net DigitalInputs  <= lcec.0.0.digital-inputs
net DigitalOutputs => lcec.0.0.digital-outputs

# --- handle the digital inputs

net DigitalInputs bitslice.0.in

net DIN0 bitslice.0.out-16
net DIN1 bitslice.0.out-17
net DIN2 bitslice.0.out-18
net DIN3 bitslice.0.out-19
net DIN4 bitslice.0.out-20
net DIN5 bitslice.0.out-21
net DIN6 bitslice.0.out-22
net DIN7 bitslice.0.out-23
net DIN8 bitslice.0.out-24
net DIN9 bitslice.0.out-25
net DIN10 bitslice.0.out-26
net DIN11 bitslice.0.out-27
net DIN12 bitslice.0.out-28
net DIN13 bitslice.0.out-29

# --- handle the Digital outputs

net DO0 bitmerge.0.in-00
net DO1 bitmerge.0.in-01
net DO2 bitmerge.0.in-02
net DO3 bitmerge.0.in-03
net DO4 bitmerge.0.in-04

net DigitalOutputs bitmerge.0.out

# Hook up three Digital Inputs to MDI commands.
net DIN0 halui.mdi-command-00 # Zero out X,Y.
net DIN1 halui.mdi-command-01 # Zero out Z.
net DIN2 halui.mdi-command-02 # Remove offset from laser.

#*********************
#   E-STOP
#*********************

setp iocontrol.0.emc-enable-in 1
